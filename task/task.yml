---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: williamyeh/ansible
    tag: ubuntu18.04

run:
  path: bash
  args:
  - -c
  - |
    server_list=((server_list))
    array=($(echo "${server_list}" | tr ',' '\n'))
    echo ${array[1]}
    echo ${array[2]}
    echo ${array[3]}
    echo ${array[0]}
    echo [master] > hosts
    echo [manager] >> hosts
    count=${#array[@]}
    for i in {1..$count}
    do
        if [ $i -eq 1 ]
        then
            sed -i "/\[master\]/a $array[1]" hosts
        fi
        sed -i "/\[manager\]/a $array[$i]" hosts
    done
    cat hosts
    echo ansible-playbook playbook.yml -i hosts --extra-vars '{"ntp_server": "((ntp_server))"}' --skip-tags 'vxflex' -u ((user_name)) -k ((password))
