---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: williamyeh/ansible
    tag: "mini-alpine3"

run:
  path: sh
  args:
  - -exc
  - |
    server_list=((server_list))
    array=$(echo "${server_list}" | tr ',' '\n')
    echo [master] > hosts
    echo [manager] >> hosts
    for i in {1..${#array[@]}}
    do
        if [ $i -eq 1 ]
        then
            sed -i "/\[master\]/a $array[1]" hosts
        fi
        sed -i "/\[manager\]/a $array[$i]" hosts
    done
    cat hosts
    echo ansible-playbook playbook.yml -i hosts --extra-vars '{"ntp_server": "((ntp_server))"}' --skip-tags 'vxflex' -u ((user_name)) -k ((password))
